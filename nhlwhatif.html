<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PuckCalcs: PSC</title>
  <style>
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Mono;
    }
    body {
      font-family: Mono;
      transition: background 0.6s;
    }
    h1, h2 {
      text-align: center;
      font-family: Mono;
    }
    .clinched-msg {
      font-size:1.3em;
      font-weight:bold;
      margin:22px 0 6px;
      text-align:center;
    }
    .card-row {
      display:flex;
      flex-wrap:wrap;
      gap:18px;
      justify-content:center;
      margin-bottom:24px;
      overflow-x:auto;
    }
    .card {
      flex:1 1 0;
      background:#eee;
      border-radius:12px;
      padding:18px;
      min-width:240px;
      max-width:350px;
      box-shadow:0 2px 12px rgba(0,0,0,0.12);
    }
    .card h3 { margin:0 0 8px; font-size:1.22rem; }
    ul { margin:0; padding-left:20px; }
    input, button, select {
      padding:10px;
      font-size:1rem;
      width:100%;
      margin-bottom:12px;
      box-sizing: border-box;
      font-family: Mono;
    }
    button {
      background:#696969;
      color:#fff;
      border:none;
      border-radius:6px;
      cursor:pointer;
      transition: background 0.2s;
      font-family: Mono;
    }
    button:hover { background:#000000; }

    .page-container {
      display: flex;

    }
    .sidebar {
      width: 7%;
      min-width: 44px;
      padding: 6px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      max-height: 100vh;
      overflow-y: visible;
      position: sticky;
      top: 0;
      box-sizing: border-box;
    }
    .sidebar img {
      width: 30px;
      height: 40px;
      display: block;
      object-fit: contain;
      margin-bottom: 2px;
      border-radius: 8px;
      transition: border-color 0.3s;
      background: none;
      box-sizing: border-box;
    }
    .sidebar-label {
      font-size: 0.8em;
      font-weight: bold;
      margin-bottom: 4px;
      margin-top: 8px;
      text-align: center;
    }
    .main-column {
      flex: 1;
      max-width: 800px;
      min-width: 0;
      margin: 0 auto;
      padding: 0 12px;
      box-sizing: border-box;
    }
    @media (max-width: 900px) {
      .sidebar {
        display: none;
      }
      .main-column {
        width: 100%;
        max-width: 100vw;
      }
      .page-container {
        flex-direction: column;
        align-items: stretch;
        height: auto;
      }
    }
  </style>
</head>
<body>
  <div class="page-container">
    <div class="sidebar east" id="east-sidebar"></div>
    <div class="main-column">
      <h1>Playoff Scenario Calc</h1>
      <div style="max-width:750px; margin:0 auto 30px;">
        <select id="teamSelect">
          <option value="">Select a team...</option>
        </select>
        <button id="calcBtn">Show Playoff Scenarios</button>
      </div>
      <div id="result"></div>
      <div id="scenario-cards"></div>
      <div id="output"></div>
    </div>
    <div class="sidebar west" id="west-sidebar"></div>
  </div>
  <script>
    const CORS_PROXY = "https://corsproxy.io/?";
    const API_URL = "https://api-web.nhle.com/v1/standings/now";
    const TOTAL_GAMES = 82;

    const divisionMap = {
      "Central": ["Chicago Blackhawks","Colorado Avalanche","Dallas Stars","Minnesota Wild","Nashville Predators","St. Louis Blues","Winnipeg Jets", "Utah Hockey Club"],
      "Pacific": ["Anaheim Ducks","Arizona Coyotes","Calgary Flames","Edmonton Oilers","Los Angeles Kings","San Jose Sharks","Vancouver Canucks","Vegas Golden Knights"],
      "Atlantic": ["Boston Bruins","Buffalo Sabres","Detroit Red Wings","Florida Panthers","Montreal Canadiens","Ottawa Senators","Tampa Bay Lightning","Toronto Maple Leafs"],
      "Metropolitan": ["Carolina Hurricanes","Columbus Blue Jackets","Philadelphia Flyers","Pittsburgh Penguins","New Jersey Devils","New York Islanders","New York Rangers","Washington Capitals"]
    };

    const conferenceMap = { "Eastern": ["Atlantic","Metropolitan"], "Western": ["Central","Pacific"] };
    const eastTeams = [
      "Boston Bruins", "Buffalo Sabres", "Detroit Red Wings", "Florida Panthers", "Montreal Canadiens", "Ottawa Senators", "Tampa Bay Lightning", "Toronto Maple Leafs",
      "Carolina Hurricanes", "Columbus Blue Jackets", "Philadelphia Flyers", "Pittsburgh Penguins", "New Jersey Devils", "New York Islanders", "New York Rangers", "Washington Capitals"
    ];
    const westTeams = [
      "Chicago Blackhawks", "Colorado Avalanche", "Dallas Stars", "Minnesota Wild", "Nashville Predators", "St. Louis Blues", "Winnipeg Jets",
      "Anaheim Ducks", "Arizona Coyotes", "Calgary Flames", "Edmonton Oilers", "Los Angeles Kings", "San Jose Sharks", "Vancouver Canucks", "Vegas Golden Knights", 
      "Utah Hockey Club"
    ];

    const allTeams = eastTeams.concat(westTeams);

    const teamAbbrevs = {
      "Anaheim Ducks": "ANA", "Arizona Coyotes": "ARI", "Boston Bruins": "BOS", "Buffalo Sabres": "BUF",
      "Calgary Flames": "CGY", "Carolina Hurricanes": "CAR", "Chicago Blackhawks": "CHI", "Colorado Avalanche": "COL",
      "Columbus Blue Jackets": "CBJ", "Dallas Stars": "DAL", "Detroit Red Wings": "DET", "Edmonton Oilers": "EDM",
      "Florida Panthers": "FLA", "Los Angeles Kings": "LAK", "Minnesota Wild": "MIN", "Montreal Canadiens": "MTL",
      "Nashville Predators": "NSH", "New Jersey Devils": "NJD", "New York Islanders": "NYI", "New York Rangers": "NYR",
      "Ottawa Senators": "OTT", "Philadelphia Flyers": "PHI", "Pittsburgh Penguins": "PIT", "San Jose Sharks": "SJS",
      "Seattle Kraken": "SEA", "St. Louis Blues": "STL", "Tampa Bay Lightning": "TBL", "Toronto Maple Leafs": "TOR",
      "Vancouver Canucks": "VAN", "Vegas Golden Knights": "VGK", "Washington Capitals": "WSH", "Winnipeg Jets": "WPG",
      "Utah Hockey Club": "UTA"
    };

    function populateSidebar(sidebarId, teams) {
      fetch('https://api-web.nhle.com/v1/standings/now')
        .then(res => res.json())
        .then(data => {
          const logoMap = {};
          data.standings.forEach(team => {
            logoMap[team.teamName.default] = team.teamLogo;
          });
          const sidebar = document.getElementById(sidebarId);
          sidebar.innerHTML = "";
          teams.forEach(name => {
            const img = document.createElement('img');
            img.src = logoMap[name] || `https://assets.nhle.com/logos/nhl/svg/${teamAbbrevs[name]}_light.svg`;
            img.alt = name;
            img.title = name;
            img.setAttribute('data-team', name);
            sidebar.appendChild(img);
          });
        })
        .catch(() => {
          const sidebar = document.getElementById(sidebarId);
          sidebar.innerHTML = "";
          teams.forEach(name => {
            const img = document.createElement('img');
            img.src = `https://assets.nhle.com/logos/nhl/svg/${teamAbbrevs[name]}_light.svg`;
            img.alt = name;
            img.title = name;
            img.setAttribute('data-team', name);
            sidebar.appendChild(img);
          });
        });
    }
    populateSidebar('east-sidebar', eastTeams);
    populateSidebar('west-sidebar', westTeams);

    // Populate dropdown with all teams
    const teamSelect = document.getElementById("teamSelect");
    allTeams.forEach(team => {
      const opt = document.createElement("option");
      opt.value = team;
      opt.textContent = team;
      teamSelect.appendChild(opt);
    });

    const nhlColors = {
      "Anaheim Ducks":             { card: "#FC4C02", cardFg: "#fff", bg: "#fff", main: "#FC4C02" },
      "Arizona Coyotes":           { card: "#8C2633", cardFg: "#fff", bg: "#fff", main: "#8C2633" },
      "Boston Bruins":             { card: "#FFB81C", cardFg: "#111", bg: "#fff", main: "#FFB81C" },
      "Buffalo Sabres":            { card: "#002654", cardFg: "#fff", bg: "#fff", main: "#002654" },
      "Calgary Flames":            { card: "#C8102E", cardFg: "#fff", bg: "#fff", main: "#C8102E" },
      "Carolina Hurricanes":       { card: "#CC0000", cardFg: "#fff", bg: "#fff", main: "#CC0000" },
      "Chicago Blackhawks":        { card: "#CF0A2C", cardFg: "#fff", bg: "#fff", main: "#CF0A2C" },
      "Colorado Avalanche":        { card: "#6F263D", cardFg: "#fff", bg: "#fff", main: "#6F263D" },
      "Columbus Blue Jackets":     { card: "#002654", cardFg: "#fff", bg: "#fff", main: "#002654" },
      "Dallas Stars":              { card: "#006847", cardFg: "#fff", bg: "#fff", main: "#006847" },
      "Detroit Red Wings":         { card: "#CE1126", cardFg: "#fff", bg: "#fff", main: "#CE1126" },
      "Edmonton Oilers":           { card: "#041E42", cardFg: "#fff", bg: "#fff", main: "#041E42" },
      "Florida Panthers":          { card: "#041E42", cardFg: "#fff", bg: "#fff", main: "#041E42" },
      "Los Angeles Kings":         { card: "#111111", cardFg: "#fff", bg: "#fff", main: "#111111" },
      "Minnesota Wild":            { card: "#154734", cardFg: "#fff", bg: "#fff", main: "#154734" },
      "Montreal Canadiens":        { card: "#AF1E2D", cardFg: "#fff", bg: "#fff", main: "#AF1E2D" },
      "Nashville Predators":       { card: "#FFB81C", cardFg: "#111", bg: "#fff", main: "#FFB81C" },
      "New Jersey Devils":         { card: "#CE1126", cardFg: "#fff", bg: "#fff", main: "#CE1126" },
      "New York Islanders":        { card: "#00539B", cardFg: "#fff", bg: "#fff", main: "#00539B" },
      "New York Rangers":          { card: "#0038A8", cardFg: "#fff", bg: "#fff", main: "#0038A8" },
      "Ottawa Senators":           { card: "#C8102E", cardFg: "#fff", bg: "#fff", main: "#C8102E" },
      "Philadelphia Flyers":       { card: "#F74902", cardFg: "#fff", bg: "#fff", main: "#F74902" },
      "Pittsburgh Penguins":       { card: "#FCB514", cardFg: "#111", bg: "#fff", main: "#FCB514" },
      "San Jose Sharks":           { card: "#006D75", cardFg: "#fff", bg: "#fff", main: "#006D75" },
      "Seattle Kraken":            { card: "#355464", cardFg: "#fff", bg: "#fff", main: "#355464" },
      "St. Louis Blues":           { card: "#002F87", cardFg: "#fff", bg: "#fff", main: "#002F87" },
      "Tampa Bay Lightning":       { card: "#002868", cardFg: "#fff", bg: "#fff", main: "#002868" },
      "Toronto Maple Leafs":       { card: "#00205B", cardFg: "#fff", bg: "#fff", main: "#00205B" },
      "Vancouver Canucks":         { card: "#00205B", cardFg: "#fff", bg: "#fff", main: "#00205B" },
      "Vegas Golden Knights":      { card: "#B4975A", cardFg: "#111", bg: "#fff", main: "#B4975A" },
      "Washington Capitals":       { card: "#041E42", cardFg: "#fff", bg: "#fff", main: "#041E42" },
      "Winnipeg Jets":             { card: "#041E42", cardFg: "#fff", bg: "#fff", main: "#041E42" },
      "Utah Hockey Club":          {card: "#6CACE3",  cardFg: "#ffffff", bg: "#ffffff", main: "#000000"}
    };

    function getDivision(team) {
      for (const d in divisionMap) if (divisionMap[d].includes(team)) return d;
      return null;
    }

    function getConference(team) {
      for (const c in conferenceMap) if (conferenceMap[c].includes(getDivision(team))) return c;
      return null;
    }

    function getScenarioText(rivals, userTeam) {
      const userPts = userTeam.points;
      return rivals.map(r => {
        const rem = TOTAL_GAMES - r.gamesPlayed;
        const name = r.teamName.default;
        const scenarios = [];

        scenarios.push(`If the ${name} lose all ${rem} remaining games, the ${userTeam.teamName.default} needs ${Math.max(0, r.points+1 - userPts)} point(s).`);
        const avg = Math.round(r.points + rem*2*0.55);
        scenarios.push(`If the ${name} finish average (${avg} pts), the ${userTeam.teamName.default} needs ${Math.max(0, avg+1 - userPts)} point(s).`);
        const hot = Math.round(r.points + rem*2*0.8);
        scenarios.push(`If the ${name} get hot (${hot} pts), the ${userTeam.teamName.default} needs ${Math.max(0, hot+1 - userPts)} point(s).`);

        return `<li><strong>Against ${name}:</strong><ul><li>${scenarios.join("</li><li>")}</li></ul></li>`;
      }).join("");
    }

    function highlightSidebarLogo(selectedTeam) {
      document.querySelectorAll('.sidebar img').forEach(img => {
        if (img.alt === selectedTeam) {
          img.style.borderColor = nhlColors[selectedTeam]?.main || '#000';
        } else {
          img.style.borderColor = '#000';
        }
      });
    }

    document.getElementById("calcBtn").addEventListener("click", async () => {
      const team = teamSelect.value;
      const resDiv = document.getElementById("result");
      const cards = document.getElementById("scenario-cards");
      cards.innerHTML = "";
      if (!team) {
        document.body.style.background = ""; // reset
        highlightSidebarLogo(null);
        return resDiv.innerHTML = "<strong>Please select a team.</strong>";
      }

      resDiv.innerHTML = "Loading...";
      try {
        const resp = await fetch(CORS_PROXY + encodeURIComponent(API_URL));
        const data = await resp.json();
        const all = data.standings;
        const user = all.find(t => t.teamName.default === team);
        if (!user) {
          document.body.style.background = ""; // reset
          highlightSidebarLogo(null);
          return resDiv.innerHTML = `<strong>Team "${team}" not found.</strong>`;
        }

        highlightSidebarLogo(user.teamName.default);

        const teamColors = nhlColors[user.teamName.default];
        if (teamColors && teamColors.bg) {
          document.body.style.background = teamColors.bg;
        } else {
          document.body.style.background = "#fff";
        }

        const clinch = user.clinchIndicator;
        const div = getDivision(user.teamName.default);
        const conf = getConference(user.teamName.default);

        const clinchMap = {
          x: "CLINCHED PLAYOFF SPOT",
          y: "CLINCHED DIVISION",
          z: "CLINCHED CONFERENCE",
          e: "ELIMINATED"
        };

        const statusLabel = clinchMap[clinch] || "";
        const statusColor = clinch === "e" ? "#aa1e1e" : clinch ? "#197d2b" : "#333";

        resDiv.innerHTML = `
          <h2>${user.teamName.default} — Pts: ${user.points}, GP: ${user.gamesPlayed}, Rem: ${TOTAL_GAMES - user.gamesPlayed}
            ${statusLabel ? `<span style="color:${statusColor}"> — ${statusLabel}</span>` : ""}
          </h2>`;

        if (clinch === "x" || clinch === "y" || clinch === "z" || clinch === "e") {
          cards.innerHTML = `<div class="clinched-msg" style="color:${statusColor}">${statusLabel}</div>`;
          return;
        }

        const divTeams = all.filter(t => getDivision(t.teamName.default) === div && t.teamAbbrev.default !== user.teamAbbrev.default);
        const confTeams = all.filter(t => getConference(t.teamName.default) === conf && t.teamAbbrev.default !== user.teamAbbrev.default);

        let top3 = [];
        for (const d of conferenceMap[conf]) {
          const sorted = all.filter(t => getDivision(t.teamName.default) === d).sort((a,b) => b.points - a.points);
          top3.push(...sorted.slice(0,3));
        }
        const wcTeams = confTeams.filter(t => !top3.find(tt => tt.teamAbbrev.default === t.teamAbbrev.default));

        const cols = teamColors || { card: "#333", cardFg: "#fff", bg: "#fff" };

        cards.innerHTML = `
          <div class="card-row">
            <div class="card" style="background:${cols.card}; color:${cols.cardFg}">
              <h3>Division Race</h3><ul>${getScenarioText(divTeams, user)}</ul>
            </div>
            <div class="card" style="background:${cols.card}; color:${cols.cardFg}">
              <h3>Wild Card Race</h3><ul>${getScenarioText(wcTeams, user)}</ul>
            </div>
          </div>`;
      } catch (err) {
        document.body.style.background = ""; 
        resDiv.innerHTML = `<strong>Error:</strong> ${err.message}`;
        highlightSidebarLogo(null);
      }
    });

    // Highlight sidebar logo on change
    teamSelect.addEventListener("change", () => {
      highlightSidebarLogo(teamSelect.value);
    });
  </script>
</body>
</html>